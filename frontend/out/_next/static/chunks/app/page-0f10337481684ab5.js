(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{132:(e,t,a)=>{"use strict";a.d(t,{dj:()=>f});var s=a(6008);let r=0,n=new Map,i=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=l(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=s.useState(d);return s.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},347:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>er});var s=a(3396),r=a(6008),n=a(7853);function i(e){e.languages.getLanguages().some(e=>"based"===e.id)||(e.languages.register({id:"based"}),e.languages.setMonarchTokensProvider("based",{tokenizer:{root:[[/loop:|until:|if |else:|elif /,"control"],[/\b(True|False)\b/,"boolean"],[/\b(and|or|not)\b/,"keyword"],[/\b(await|return|break|continue)\b/,"keyword"],[/\b(talk|say|ask|api\.get_req|api\.post_req)\b/,"fexpr"],[/".*?"/,"string"],[/'.*?'/,"string"],[/\/\/.*$/,"comment"],[/#.*$/,"comment"],[/\b\d+(\.\d+)?\b/,"number"],[/[\[\](){},.:;=]/,"delimiter"]]}}),e.editor.defineTheme("based-theme",{base:"vs-dark",inherit:!0,rules:[{token:"control",foreground:"569CD6",fontStyle:"bold"},{token:"boolean",foreground:"569CD6"},{token:"fexpr",foreground:"4EC9B0"},{token:"string",foreground:"CE9178"},{token:"comment",foreground:"6A9955",fontStyle:"italic"},{token:"number",foreground:"B5CEA8"}],colors:{"editor.background":"#000000","editor.foreground":"#D4D4D4","editor.lineHighlightBackground":"#2A2D2E","editorCursor.foreground":"#AEAFAD","editor.selectionBackground":"#264F78","editorIndentGuide.background":"#404040"}}))}function l(e){let{value:t,onChange:a,language:r="based",options:l}=e;return(0,s.jsx)("div",{className:"w-full h-full overflow-auto",children:(0,s.jsx)(n.Ay,{height:"100%",defaultLanguage:r,value:t,onChange:e=>a(null!=e?e:""),theme:"based-theme",beforeMount:function(e){i(e)},options:{fontSize:14,minimap:{enabled:!1},fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace",scrollBeyondLastLine:!0,automaticLayout:!0,wordWrap:"on",lineNumbers:"on",tabSize:2,renderLineHighlight:"all",...l}})})}function o(e){let{original:t,modified:a,language:r="based",originalLabel:l="Before",modifiedLabel:o="After"}=e;return t||a?(0,s.jsxs)("div",{className:"w-full h-full overflow-auto flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center px-6 py-2 border-b border-border bg-background/90 sticky top-0 z-10",children:[(0,s.jsx)("span",{className:"font-semibold text-xs text-muted-foreground uppercase tracking-wider",children:l}),(0,s.jsx)("span",{className:"font-semibold text-xs text-muted-foreground uppercase tracking-wider",children:o})]}),(0,s.jsx)("div",{className:"flex-1 min-h-[400px]",children:(0,s.jsx)(n.zC,{height:"100%",language:r,original:t,modified:a,theme:"based-theme",beforeMount:function(e){i(e)},options:{fontSize:14,minimap:{enabled:!1},fontFamily:"monospace",scrollBeyondLastLine:!1,renderSideBySide:!0,readOnly:!0,renderLineHighlight:"all",renderIndicators:!0,lineNumbers:"on"}})})]}):(0,s.jsx)("div",{className:"p-4 text-muted-foreground",children:"No diff to display."})}var d=a(4649),c=a(620),u=a(759);let f=(0,c.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),m=r.forwardRef((e,t)=>{let{className:a,variant:r,size:n,asChild:i=!1,...l}=e,o=i?d.DX:"button";return(0,s.jsx)(o,{className:(0,u.cn)(f({variant:r,size:n,className:a})),ref:t,...l})});m.displayName="Button";var x=a(9385),p=a(8209);function g(e){let{filename:t,content:a,editorValue:n,diff:i,oldCode:d,newCode:c,onClearDiff:u,onSave:f,sendMessage:g,validationError:h,onEditorValueChange:b,isProcessing:v,isDiffPending:j}=e,[N,y]=(0,r.useState)(n);(0,r.useEffect)(()=>{y(n)},[n,t]);let w=v||j;return(0,s.jsx)("div",{className:"relative h-full",children:(0,s.jsx)("div",{className:"h-full pb-[120px]",children:t&&a?i?(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center px-4 py-2 border-b border-border",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium",children:["Suggested Changes to ",t]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(m,{variant:"outline",size:"sm",className:"h-7 gap-1",onClick:()=>{v||u()},disabled:v,children:[(0,s.jsx)(x.A,{className:"h-3.5 w-3.5"}),"Reject"]}),(0,s.jsxs)(m,{variant:"default",size:"sm",className:"h-7 gap-1",onClick:()=>{v||(g({action:"apply_diff",filename:t,diff:i}),u())},disabled:v,children:[(0,s.jsx)(p.A,{className:"h-3.5 w-3.5"}),"Accept"]})]})]}),h&&(0,s.jsxs)("div",{className:"bg-destructive/10 border-l-4 border-destructive p-3 text-sm",children:[(0,s.jsx)("h4",{className:"font-medium text-destructive mb-1",children:"Validation Error"}),(0,s.jsx)("div",{className:"text-xs whitespace-pre-wrap",children:h})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto",children:(0,s.jsx)(o,{original:d||"",modified:c||"",language:"based",originalLabel:"Current Code",modifiedLabel:"Proposed Changes"})})]}):(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center px-4 py-2 border-b border-border",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:t}),(0,s.jsx)(m,{variant:"outline",size:"sm",className:"h-7",onClick:()=>{t&&!w&&f(t,N)},disabled:w,children:"Save"})]}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(l,{value:N,onChange:e=>{!w&&(y(e),b&&b(e))},language:"based",options:{readOnly:w}})})]}):(0,s.jsx)("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground",children:(0,s.jsx)("p",{className:"mb-4",children:"No file yet. Start by describing your agent idea below."})})})})}var h=a(83),b=a(7053);function v(e){let{files:t,activeFile:a,onSelectFile:r,isLocked:n}=e;return(0,s.jsxs)("div",{className:"h-full flex flex-col bg-background",children:[(0,s.jsx)("div",{className:"flex items-center justify-between p-2 border-b border-border",children:(0,s.jsx)("h2",{className:"text-sm font-medium",children:"EXPLORER"})}),(0,s.jsxs)("div",{className:"px-1 py-2",children:[(0,s.jsxs)("div",{className:"flex items-center text-xs text-muted-foreground gap-1 pl-2 py-1",children:[(0,s.jsx)(h.A,{className:"h-3.5 w-3.5"}),(0,s.jsx)("span",{children:"WORKSPACE"})]}),(0,s.jsxs)("div",{className:"space-y-0.5 mt-1",children:[t.map(e=>(0,s.jsxs)("button",{onClick:()=>!n&&r(e),disabled:n,className:(0,u.cn)("w-full flex items-center px-2 py-1 text-xs rounded-sm text-left gap-1.5",a===e?"bg-accent text-accent-foreground":"hover:bg-accent/50 hover:text-accent-foreground"),children:[(0,s.jsx)(b.A,{className:"h-3.5 w-3.5 shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:e})]},e)),0===t.length&&(0,s.jsx)("div",{className:"px-2 py-3 text-xs text-muted-foreground",children:"Use the chat to create your first file!"})]})]})]})}var j=a(6338),N=a(4935),y=a(4926),w=a(5317),k=a(8574),S=a(1064);function C(e){let{connectionStatus:t,isProcessing:a,isDiffPending:r}=e;"connected"===t?j.A:"connecting"===t?N.A:y.A;let n="";return a?n="Processing (Editor locked)...":r&&(n="Review pending changes"),(0,s.jsxs)("header",{className:"flex h-14 items-center border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 px-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mr-4",children:[(0,s.jsx)(w.A,{className:"w-6 h-6 text-primary"}),(0,s.jsx)("span",{className:"font-semibold text-lg",children:"Kafka"})]}),(0,s.jsxs)("nav",{className:"hidden md:flex items-center space-x-4 lg:space-x-6 mx-6",children:[(0,s.jsx)(m,{variant:"ghost",size:"sm",className:"h-8 px-2",children:"File"}),(0,s.jsx)(m,{variant:"ghost",size:"sm",className:"h-8 px-2",children:"Edit"}),(0,s.jsx)(m,{variant:"ghost",size:"sm",className:"h-8 px-2",children:"View"}),(0,s.jsx)(m,{variant:"ghost",size:"sm",className:"h-8 px-2",children:"Help"})]}),(0,s.jsxs)("div",{className:"hidden md:flex items-center ml-auto gap-2",children:[n&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(N.A,{className:"h-4 w-4 animate-spin"})," ",(0,s.jsx)("span",{children:n})]}),(0,s.jsxs)("div",{className:(0,u.cn)("flex items-center gap-2 text-xs px-3 py-1 rounded-full",(()=>{switch(t){case"connected":return"bg-green-500/10 text-green-400";case"connecting":return"bg-yellow-500/10 text-yellow-400";case"disconnected":return"bg-red-500/10 text-red-400"}})()),children:[(0,s.jsx)("div",{className:(0,u.cn)("w-2 h-2 rounded-full","connected"===t?"bg-green-400":"connecting"===t?"bg-yellow-400":"bg-red-400")}),"connected"===t?"Connected":"connecting"===t?"Connecting...":"Disconnected"]}),(0,s.jsxs)(m,{variant:"outline",size:"sm",className:"gap-1",children:[(0,s.jsx)(k.A,{className:"h-4 w-4 mr-1"}),".based"]}),(0,s.jsxs)(m,{size:"sm",variant:"default",children:[(0,s.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Sign In"]})]})]})}var A=a(132),_=a(5472),E=a(8958);let z=e=>{let{className:t,...a}=e;return(0,s.jsx)(E.YZ,{className:(0,u.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...a})},T=E.Zk,D=e=>{let{withHandle:t,className:a,...r}=e;return(0,s.jsx)(E.TW,{className:(0,u.cn)("relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",a),...r,children:t&&(0,s.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:(0,s.jsx)(_.A,{className:"h-2.5 w-2.5"})})})},R=r.forwardRef((e,t)=>{let{className:a,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,u.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...n})});R.displayName="Input";let O=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,u.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...r})});O.displayName="Textarea";var I=a(3331),L=a(9161),F=a(7230),M=a(2676);let U=M.Kq,P=M.bL,W=M.l9;r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(M.UC,{ref:t,sideOffset:r,className:(0,u.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})}).displayName=M.UC.displayName;var H=a(1279);let V=H.bL,B=H.l9,K=H.ZL,q=H.bm,Y=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.hJ,{ref:t,className:(0,u.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});Y.displayName=H.hJ.displayName;let G=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(K,{children:[(0,s.jsx)(Y,{}),(0,s.jsxs)(H.UC,{ref:t,className:(0,u.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[r,(0,s.jsxs)(H.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(x.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});G.displayName=H.UC.displayName;let J=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,u.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};J.displayName="DialogHeader";let X=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,u.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};X.displayName="DialogFooter";let Z=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.hE,{ref:t,className:(0,u.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});Z.displayName=H.hE.displayName;let $=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.VY,{ref:t,className:(0,u.cn)("text-sm text-muted-foreground",a),...r})});function Q(e){let{children:t}=e;return(0,s.jsxs)(V,{children:[(0,s.jsx)(B,{asChild:!0,children:t}),(0,s.jsxs)(G,{className:"sm:max-w-[700px] z-[60]",children:[(0,s.jsxs)(J,{children:[(0,s.jsx)(Z,{children:"How Kafka Works"}),(0,s.jsx)($,{children:"Vibe-code your AI agents using natural language."})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4 text-sm",children:[(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:"1. Creating Your First Agent"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:'Simply describe the agent you want to create in the prompt bar below (e.g., "Create a simple chatbot that greets the user"). Kafka will automatically generate the `.based` file for you, named based on your description.'})]}),(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:"2. Modifying Your Agent"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:'With a file open, describe the changes you want (e.g., "Change the greeting message", "Add a function to ask for the user\'s name"). Kafka will generate a diff (code changes) for the active file.'})]}),(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:"3. Applying Changes (Diffs)"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:'Review the suggested changes in the diff viewer. Click "Accept" to apply them to your code, or "Reject" to discard them. You can then refine your request in the prompt bar.'})]}),(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:"4. Creating Additional Files"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:'To create more files for organization (e.g., utility functions, different agent parts), explicitly ask in the prompt: "Create a new file for database utilities" or "Make an agent file to handle user profiles". Kafka will create and name the new file.'})]}),(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:"Adding Context"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:'Use the "Add context" button to provide extra details, examples, or instructions to help the AI better understand your requests, especially for complex changes or new files.'})]})]}),(0,s.jsx)(X,{children:(0,s.jsx)(q,{asChild:!0,children:(0,s.jsx)(m,{type:"button",variant:"secondary",children:"Got it!"})})})]})]})}function ee(e){let{onSubmit:t,isProcessing:a=!1,isLocked:n}=e,[i,l]=(0,r.useState)(""),[o,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(""),f=(0,r.useRef)(null);(0,r.useEffect)(()=>{f.current&&f.current.focus()},[]);let x=()=>{!i.trim()||a||n||(t(i,o?c:void 0),l(""),u(""),d(!1),setTimeout(()=>{f.current&&!a&&f.current.focus()},0))};return(0,s.jsxs)("div",{className:"bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 rounded-2xl border border-border shadow-xl px-6 pt-4 pb-5 flex flex-col gap-3",children:[(0,s.jsx)(R,{ref:f,value:i,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x())},placeholder:a?"AI is thinking...":"Ask a question, make a change, go wild...",className:"rounded-full px-5 py-2 text-base shadow-sm border border-input focus:ring-2 focus:ring-ring focus:outline-none transition-all",disabled:a||n}),o&&(0,s.jsx)(O,{value:c,onChange:e=>u(e.target.value),placeholder:"Add context for your prompt (optional)",className:"mt-2 rounded-md border border-input min-h-[60px] max-h-[120px] text-sm",disabled:a||n}),(0,s.jsxs)("div",{className:"flex items-end justify-between mt-1",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(U,{children:[(0,s.jsx)(P,{children:(0,s.jsx)(W,{asChild:!0,children:(0,s.jsxs)(m,{variant:"ghost",size:"sm",className:"flex items-center gap-1 px-2",onClick:()=>d(e=>!e),disabled:a||n,children:[(0,s.jsx)(I.A,{className:"h-4 w-4"}),o?"Hide context":"Add context"]})})}),(0,s.jsx)(Q,{children:(0,s.jsxs)(m,{variant:"ghost",size:"sm",className:"flex items-center gap-1 px-2",disabled:a||n,children:[(0,s.jsx)(L.A,{className:"h-4 w-4"}),"Help"]})})]})}),(0,s.jsx)(m,{variant:"default",size:"lg",className:"flex items-center gap-2 px-6 rounded-full",onClick:x,disabled:!i.trim()||a||n,children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.A,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):(0,s.jsxs)(s.Fragment,{children:["Send",(0,s.jsx)(F.A,{className:"h-4 w-4"})]})})]})]})}$.displayName=H.VY.displayName;var et=a(7104),ea=a(316);function es(e){let{chatMessages:t}=e;return(0,s.jsxs)("div",{className:"h-full flex flex-col bg-background border-l border-border",children:[(0,s.jsx)("div",{className:"p-4 border-b border-border",children:(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Conversation"})}),(0,s.jsx)("div",{className:"flex-1 p-4 overflow-y-auto",children:(0,s.jsxs)("div",{className:"space-y-4",children:[t.map(e=>(0,s.jsxs)("div",{className:(0,u.cn)("flex items-start gap-3 p-3 rounded-lg max-w-[90%]","user"===e.role?"bg-primary/10 ml-auto":"system"===e.role?"bg-amber-400/10 mx-auto text-xs text-amber-600 border border-amber-400/30":"bg-muted/50 mr-auto"),children:["user"===e.role&&(0,s.jsx)(et.A,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),"agent"===e.role&&(0,s.jsx)(ea.A,{className:"h-5 w-5 text-muted-foreground flex-shrink-0 mt-0.5"}),(0,s.jsx)("p",{className:(0,u.cn)("text-sm whitespace-pre-wrap break-words","system"===e.role?"italic":""),children:e.content})]},e.id)),0===t.length&&(0,s.jsx)("div",{className:"text-center text-sm text-muted-foreground py-8",children:"Conversation history will appear here."})]})})]})}function er(){var e,t,a,n,i,l,o;let[d,c]=(0,r.useState)([]),[u,f]=(0,r.useState)(null),[m,x]=(0,r.useState)({}),{toast:p}=(0,A.dj)(),[h,b]=(0,r.useState)([]),{connect:j,sendMessage:N,lastMessage:y,connectionStatus:w}=function(){let{toast:e}=(0,A.dj)(),t=(0,r.useRef)(null),[a,s]=(0,r.useState)(null),[n,i]=(0,r.useState)("disconnected"),l=(0,r.useRef)(null),o=(0,r.useCallback)(()=>{if(t.current&&t.current.readyState===WebSocket.OPEN)return;i("connecting");let a=new WebSocket("ws://localhost:8000/ws");t.current=a,a.onopen=()=>i("connected"),a.onclose=()=>{i("disconnected"),e({title:"Connection Lost",description:"Connection to server lost. Attempting to reconnect in  5 seconds...",variant:"destructive"}),l.current=setTimeout(o,5e4)},a.onerror=()=>i("disconnected"),a.onmessage=e=>s(e.data)},[]),d=(0,r.useCallback)(e=>{t.current&&t.current.readyState===WebSocket.OPEN&&t.current.send(JSON.stringify(e))},[]);return(0,r.useEffect)(()=>(o(),()=>{var e;l.current&&clearTimeout(l.current),null==(e=t.current)||e.close()}),[o]),{connect:o,sendMessage:d,lastMessage:a,connectionStatus:n}}(),[k,S]=(0,r.useState)({}),[_,E]=(0,r.useState)(null),[R,O]=(0,r.useState)(!1);(0,r.useEffect)(()=>{j()},[j]),(0,r.useEffect)(()=>{let e;if(y){try{e=JSON.parse(y)}catch(e){console.error("Failed to parse WebSocket message:",y,e),setTimeout(()=>{p({title:"WebSocket Error",description:"Received invalid message format.",variant:"destructive"})},0),O(!1);return}if("error"===e.status){E(e.error),setTimeout(()=>{p({title:"Error (".concat(e.action||"General",")"),description:e.error,variant:"destructive"})},0),O(!1),"apply_diff_error"===e.action&&e.filename&&S(t=>{let a={...t};return delete a[e.filename],a});return}switch(_&&E(null),e.action){case"initial_state":c(e.files||[]),f(null),x({}),S({}),b([]),O(!1);break;case"file_list":var t;c(e.files||[]),!u||(null==(t=e.files)?void 0:t.includes(u))||f(null);break;case"file_content":e.filename&&e.filename===u&&(x(t=>{var a;return{...t,[e.filename]:null!=(a=e.content)?a:""}}),k[e.filename]&&S(t=>{let a={...t};return delete a[e.filename],a}));break;case"file_created":c(e.files||[]),f(e.filename),x(t=>{var a;return{...t,[e.filename]:null!=(a=e.content)?a:""}}),O(!1),b(t=>[...t,{id:crypto.randomUUID(),role:"system",content:"Created file: ".concat(e.filename)}]);break;case"diff_generated":e.filename&&e.diff&&(S(t=>({...t,[e.filename]:{diff:e.diff,old_code:e.old_code,new_code:e.new_code}})),b(t=>[...t,{id:crypto.randomUUID(),role:"system",content:"Diff generated for ".concat(e.filename,". Review the changes.")}])),O(!1);break;case"diff_applied":e.filename&&(S(t=>{let a={...t};return delete a[e.filename],a}),x(t=>{var a;return{...t,[e.filename]:null!=(a=e.new_code)?a:""}}),b(t=>[...t,{id:crypto.randomUUID(),role:"system",content:"Changes applied to ".concat(e.filename,".")}]),setTimeout(()=>{p({title:"Diff Applied",description:"Changes applied to ".concat(e.filename)})},0)),O(!1);break;case"file_uploaded":c(e.files||[]);break;case"edit_error":case"apply_diff_error":O(!1);break;default:console.warn("Received unknown WebSocket action:",e.action),O(!1)}}},[y,p,N]);let I=(0,r.useCallback)(N,[N]),L=(0,r.useCallback)(e=>{if(e===u||R)return;let t=u?m[u]:void 0;u&&void 0!==t&&(I({action:"upload_file",filename:u,content:t}),p({title:"Auto-saved",description:"".concat(u," saved.")})),f(e),x(t=>{var a;return{...t,[e]:null!=(a=t[e])?a:"Loading..."}}),I({action:"read_file",filename:e})},[u,R,m,I,p]),F=(0,r.useCallback)((e,t)=>{e.trim()&&!R&&(O(!0),E(null),b(t=>[...t,{id:crypto.randomUUID(),role:"user",content:e}]),t&&b(e=>[...e,{id:crypto.randomUUID(),role:"agent",content:"Context provided: ".concat(t)}]),I({action:"prompt",prompt:e.trim(),activeFile:u,context:t}))},[R,u,I]),M=(0,r.useCallback)((e,t)=>{x(a=>({...a,[e]:t}))},[k,p]),U=(0,r.useCallback)(()=>{if(!u||R)return;let e=m[u];if(void 0===e)return void console.warn("Attempted to save file with no content loaded:",u);I({action:"upload_file",filename:u,content:e}),p({title:"File Saved",description:"'".concat(u,"' saved.")})},[u,R,m,k,I,p]),P=(0,r.useCallback)(e=>{S(t=>{let a={...t};return a[e]&&(delete a[e],setTimeout(()=>{p({title:"Diff Cleared",description:"Changes for ".concat(e," discarded.")})},0)),a})},[p]),W=!!(u&&k[u]),H=R||W,V=u&&null!=(l=null!=(i=null==(e=k[u])?void 0:e.old_code)?i:m[u])?l:"",B=u?null==(t=k[u])?void 0:t.diff:null;return(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[(0,s.jsx)(C,{connectionStatus:w,isProcessing:R,isDiffPending:W}),(0,s.jsxs)(z,{direction:"horizontal",className:"flex-1 border-t",children:[(0,s.jsx)(T,{defaultSize:20,minSize:15,maxSize:30,children:(0,s.jsx)(v,{files:d,activeFile:u,onSelectFile:L,isLocked:H})}),(0,s.jsx)(D,{withHandle:!0}),(0,s.jsxs)(T,{defaultSize:55,minSize:30,children:[" ",(0,s.jsx)(g,{filename:u,content:V,diff:B,editorValue:u&&null!=(o=m[u])?o:"",oldCode:u?null==(a=k[u])?void 0:a.old_code:null,newCode:u?null==(n=k[u])?void 0:n.new_code:null,onEditorValueChange:e=>{u&&M(u,e)},onSave:()=>{u&&U()},sendMessage:I,onClearDiff:()=>{u&&P(u)},validationError:_,isProcessing:R,isDiffPending:W})]}),(0,s.jsx)(D,{withHandle:!0}),(0,s.jsxs)(T,{defaultSize:25,minSize:20,children:[(0,s.jsx)(es,{chatMessages:h})," "]})]}),(0,s.jsx)("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 w-full max-w-3xl px-4 z-50",children:(0,s.jsx)(ee,{onSubmit:F,isLocked:H})})]})}},759:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(5642),r=a(5667);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},8329:(e,t,a)=>{Promise.resolve().then(a.bind(a,347))}},e=>{var t=t=>e(e.s=t);e.O(0,[828,724,787,195,358],()=>t(8329)),_N_E=e.O()}]);