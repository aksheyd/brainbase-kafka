# Kafka: Vibe-code Agents

Kafka allows you to create and modify AI agents using natural language. Describe your agent idea or desired changes, and Kafka handles the code generation, diffing, and validation.

---

## Core Concepts

- **Vibe-Coding**: Build agents by describing them, not by manually writing every line.
- **Prompt-Driven**: Start by describing your agent. Kafka creates the first file, named intelligently based on your description.
- **Intent Classification**: Kafka determines if you want to create a new file or edit the current one based on your prompt.
- **Iterative Development**: Request changes, review the generated diffs, and accept them to evolve your agent.
- **Validation**: Generated code is automatically validated against the Based specification.

---

## Project Structure

- `backend/`: Python FastAPI server with WebSocket support for the AI agent logic.
- `frontend/`: Next.js/React UI for interacting with the agent.

---

## Quick Start

You can run both the backend and frontend servers together using the provided script:

> ⚠️ If you have not setup and installed the dependencies (below) first, the script will not work correctly.


```sh
./run_kafka.sh
```

This will start both servers in the correct directories and shut them down cleanly when you exit the script.

---

## Backend (Python)

- Stateful AI agent using LLMs (via LangChain/Google Generative AI).
- Handles intent classification (Create File vs. Edit File).
- Generates filenames based on user prompts.
- Creates and validates Based code and diffs.
- Real-time communication via WebSockets.

### Setup & Running

1.  **Prerequisites**: Python 3.13+, [`uv`](https://github.com/astral-sh/uv) (recommended).
2.  **Environment**: Copy `.env.example` to `.env` and add your `GOOGLE_API_KEY`.
3.  **Install Dependencies**:
    ```sh
    cd backend
    uv venv --python 3.13 # Or your specific 3.13+ patch version
    source .venv/bin/activate
    uv sync --locked
    ```
4. **Run**: 
    `uv run fastapi dev main.py` for debugging
    `uv run uvicorn main:app --port 8000` for "prod" (ideally wrap gunicorn and nginx and hard install uvicorn)
    - Endpoint at [http://localhost:8000](http://localhost:8000)
---

## Frontend (Next.js)

### Features

- Modern UI inspired by code editors (File Explorer, Editor, Diff Viewer).
- Real-time interaction with the backend via WebSockets.
- Built with Next.js 15, React 19, Tailwind CSS, shadcn/ui, Monaco Editor.

### Setup & Running

1.  **Prerequisites**: Node.js 18+, `pnpm`.
2.  **Install Dependencies**:
    ```sh
    cd frontend
    pnpm install
    ```
3.  **Run**: 
    `pnpm dev` for debugging
    `pnpm build && npx serve@latest out` for "prod"
    - App at [http://localhost:3000](http://localhost:3000)
---

## Communication Protocol

Interaction primarily uses WebSockets (`ws://localhost:8000/ws`). Key actions sent **from** the client:

- **`prompt`**: The main action. Sends the user's text input. The backend determines the intent (create/edit) and performs the relevant action.
- **`apply_diff`**: Sent by the client to apply a diff generated by the backend.
- **`upload_file`, `list_files`, `read_file`**: Used for file management (e.g., auto-save, manual file creation/uploads).

Key actions sent **to** the client:

- **`initial_state`**: Sent on connection with the initial file list.
- **`file_created`**: Sent after the backend creates a new file via a prompt.
- **`diff_generated`**: Sent with the diff details after an edit request.
- **`diff_applied`**: Confirms a diff was successfully applied.
- **`file_list`, `file_content`**: Responses to corresponding client requests.
- Error actions (e.g., `edit_error`, `apply_diff_error`).

For more details, see the [backend/COMM_PROTOCOL.md](backend/COMM_PROTOCOL.md) file.

---

## Future Roadmap

- **File Management Menus:** Enable full File/Edit/View/Help menu functionality for advanced workspace operations.
- **User Authentication:** Integrate sign-in and user profiles for personalized agent workspaces.
- **Manual File Creation & Diff Tools:** Add UI for manual file creation, naming, and diff generation.
- **Collaboration:** Real-time multi-user editing and agent development.
- **Plugin/Extension Support:** Allow users to extend agent capabilities with plugins.
- **Cloud Sync:** Save agents to the cloud.

---
